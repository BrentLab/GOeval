---
title: "GOeval"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{GOeval}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

First, install and load this package. It is easiest to use either the "devtools" or "remotes" package to do so. "remotes" is a smaller package, so it might be the better option if you do not want to install all of "devtools."

```{r, eval = FALSE}
devtools::install_github("westbrooktm/GOeval", ref = "dev")
# OR
remotes::install_github("westbrooktm/GOeval", ref = "dev")
```

```{r setup}
library("GOeval")
```

Steps to use this package from original network to graphing the results:

1. subset_network to create network subsets with the top-weighted edges (not yet shown)

2. webgestalt_network on each of the network subsets to generate ORA results

3. get_metrics on the stored ORA results to calculate summary statistics for plotting

4. plot_metrics using the output of get_metrics
\
\
\

First, we set a path to the directory that contains the test data, so we can use it for the following examples.

```{r}
data_dir <- file.path(system.file(package = "GOeval"), "data")
```

```{r, echo = FALSE}
data_dir <- "data"
```

1. subset_network

"marbach_extract.tsv" contains 3 columns: the TFs, the regulated genes, and the scores.

This function sorts the input network in descending order by the values in the third column and creates files in the output_folder with only the rows that have the highest scores.

```{r, eval = FALSE}
  input_file <- file.path(data_dir, "marbach_extract.tsv")
  # The output_directory is not put in data_dir.
  # You do not want to save the output in the package itself.
  output_directory <- file.path("data", "marbach_network_subsets")
  name <- "marbach"
  edges <- c(64, 128, 256, 512, 1024, 2048, 4096, 8192)
  perTF <- FALSE
  
  subset_network(input_file, output_directory, name, edges, perTF)
```

2. webgestalt_network

Run ORA using the webgestalt_network function on "small_net_194", which is a small example network with 5 TFs that have an average of 194 target genes. 
"small_net.tsv" is tab-separated with the first column containing the TF names and the second column containing the regulated gene names. 
"small_net_gene_universe.txt" contains one column of the names of all genes that could appear in the network.

Note organism = "hsapiens" and database = "geneontology_Biological_Process_noRedundant" is the default database for ORA.

You can see more options for organism and database with WebGestaltR::listOrganism() and WebGestaltR::listGeneSet() respectively.
```{r, eval = FALSE}
# Again, the output_directory is not put in data_dir.
webgestalt_network(network_path = file.path(data_dir, "small_net.tsv"), reference_set = file.path(data_dir, "small_net_gene_universe.txt"), output_directory = file.path("data", "small_net_output"), network_name = "small_net_194", permutations = 2)
```

3. get_metrics

Specify which metrics to calculate and use mapply to run get_metrics on each of the output_folders. The argument "get_sum" is set to TRUE by default.

A wrapper function will be made in the near future so mapply will be unnecessary.
```{r}
  # Specify which folders contain the data for each network.
  # Each element will be a folder used as the output folder for a call to webgestalt_network.
  # For the sake of run time, the data used in this example was premade.
  output_folders <- c(file.path(data_dir, "np3_example"), file.path(data_dir, "marbach_example"))

  metric_dfs_by_net <- mapply(get_metrics, output_folders, MoreArgs=list(get_percent = TRUE, get_mean = TRUE, get_median = TRUE, get_annotation_overlap = TRUE, parallel = FALSE), SIMPLIFY = FALSE)
```

4. plot_metrics

```{r}
  # Specify the main titles of the output graphs
  title_text = "NP3 vs Marbach et al."
  subtitle_text = "subset for overlapping TFs"
  
  plot_metrics(metric_dfs_by_net, title_text, subtitle_text)
```
