---
title: "GOeval"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{GOeval}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Steps to use this package from original network to graphing the results:

1. subset_network to create network subsets with the top-weighted edges (not yet shown)

2. webgestalt_network on each of the network subsets to generate ORA results

3. get_metrics on the stored ORA results to calculate summary statistics for plotting

4. plot_metrics using the output of get_metrics

```{r setup}
library(GOeval)
```

1. subset_network
```{r, eval = FALSE}
# subset_network()
```

2. webgestalt_network

Run ORA using the webgestalt_network function on "small_net_194", which is a small example network with 5 TFs that have an average of 194 target genes.

Note organism = "hsapiens" and database = "geneontology_Biological_Process_noRedundant" is the default database for ORA.

You can see more options for organism and database with WebGestaltR::listOrganism() and WebGestaltR::listGeneSet() respectively.
```{r, eval = FALSE}
webgestalt_network(network_path = file.path("data", "small_net.tsv"), reference_set = file.path("data", "small_net_gene_universe.txt"), output_directory = file.path("data", "small_net_output"), network_name = "small_net_194", permutations = 2)
```

3. get_metrics

Specify which metrics to calculate and use mapply to run get_metrics on each of the output_folders.

A wrapper function will be made in the near future so mapply will be unnecessary.
```{r}
  # Specify which folders contain the data for each network.
  # Each element will be a folder used as the output folder for a call to webgestalt_network.
  # For the sake of run time, the data used in this example was premade.
  output_folders <- c(file.path("data", "np3_example"), file.path("data", "marbach_example"))
  
  metric_dfs_by_net <- mapply(get_metrics, output_folders, MoreArgs=list(get_percent = TRUE, get_mean = TRUE, get_median = TRUE, get_annotation_overlap = TRUE, parallel = FALSE), SIMPLIFY = FALSE)

  # 4. plot_metrics
  
  # Specify the main title of the output graphs
  title_text = "NP3 vs Marbach et al."
  subtitle_text = "subset for overlapping TFs"
  
  plot_metrics(metric_dfs_by_net, title_text, subtitle_text)
```
